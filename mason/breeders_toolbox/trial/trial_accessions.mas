
<%args>
$trial_id
</%args>

<& /util/import_javascript.mas, classes => [  ] &>


<div id="trial_accessions_html">
</div>

<script>

jQuery(document).ready(function () {

    jQuery('#trial_accessions_onswitch').one("click",  function() {

	jQuery.ajax ( {
            url : '/ajax/breeders/trial/'+<% $trial_id %>+'/accessions',
	    beforeSend: function() {
		jQuery("#working_modal").modal("show");
	    },
	    success: function(response){
	        // console.log(response);
		jQuery("#working_modal").modal("hide");
		var trial_accessions_html = "<table class='table table-hover table-condensed table-bordered' id='trial_design_accessions_table'><thead><tr><th>Unique Name</th></tr></thead><tbody>";
		for (i=0; i<response.accessions[0].length; i++) {
		    trial_accessions_html = trial_accessions_html + "<tr><td><a href='/stock/" + response.accessions[0][i].stock_id +"/view'>"+ response.accessions[0][i].accession_name + "</a></td></tr>";
		}
		trial_accessions_html = trial_accessions_html + "</tbody></table>";
		jQuery('#trial_accessions_html').empty();
		jQuery('#trial_accessions_html').html(trial_accessions_html);
        enable_accessions_datatable();
	    },
	    error: function(response){
	        jQuery("#working_modal").modal("hide");
		alert("Error retrieving accessions.");
	    }
	});
    });

});

function enable_accessions_datatable() {
    jQuery('#trial_design_accessions_table').DataTable();
}

</script>
